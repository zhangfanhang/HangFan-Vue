import{N as z,q as o,n as Z,r as _,o as ee,b as ae,g as C,e as l,w as s,i as v,t as le,E as V,Q as D}from"./index.97ded6be.js";import{r as te}from"./zh-cn.54e2677e.js";import{_ as oe,C as se}from"./CommonBtns.c3b1a12c.js";import{u as ne}from"./useMessageBox.6d5b6efb.js";import{_ as re}from"./lodash.6bf63fca.js";import{r as x}from"./request.d016c993.js";import{_ as ue}from"./_plugin-vue_export-helper.cdc0426e.js";async function ie(i){return x({url:"/roles/list",method:"get",data:i})}async function q(i){return x({url:"/roles/operate",method:"post",data:i})}async function de(i){return x({url:"/roles/update/permission",method:"post",data:i})}function me(i){return x({url:"/menu/list",method:"get",data:i})}const ce={class:"role-manage"},pe={class:"role-manage-from"},fe={class:"role-manage-table-btns",ref:"testRef"},_e=v("\u65B0\u589E"),ve={class:"role-manage-table"},he=v("\u53D6 \u6D88"),ge=v("\u786E \u5B9A"),ye={style:{height:"300px",width:"100%","overflow-y":"auto"}},be=v("\u53D6 \u6D88"),we=v("\u786E \u5B9A"),ke={__name:"Role",setup(i){z.locale("zh-cn"),z.extend(te);const c=o({remark:"",roleName:""}),E={roleName:[{required:!0,message:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D",trigger:"change"}]};let y=o(""),h=o(!1),f=o(!1),b=o("\u65B0\u589E\u89D2\u8272");const S=o(),F=o(),w=o(),k=o(),g=o({roleName:""});let p=o({pageSize:10,pageNum:1}),K=o(""),M=o(!0),P=o(0),L=o([]),R=o([]),I=o(""),T=o({});const U=async()=>{R.value=await me(),B(re.cloneDeep(R.value))},B=a=>{const e=n=>{n.forEach(t=>{t.children&&t.action?T.value[t._id]=t.menuName:t.children&&!t.action&&e(t.children)})};e(a)},H=async()=>{w.value.validate(async a=>{a&&(await q({...c.value,action:y.value}),y.value==="create"?V.success("\u89D2\u8272\u521B\u5EFA\u6210\u529F"):V.success("\u4FE1\u606F\u66F4\u65B0\u6210\u529F"),await d(),f.value=!1)})},Y=()=>{S.value.resetFields(),d()},d=async()=>{M.value=!0;let a={...g.value,...p.value},{list:e,page:n}=await ie(a);P.value=n.total,L.value=e,M.value=!1},j=a=>{p.value.pageSize=a.pageSize,p.value.pageNum=a.currentPage,d()},O=a=>{p.value.pageNum=a,d()},$=async()=>{f.value=!0,b.value="\u65B0\u589E\u89D2\u8272",y.value="create",await D(),w.value.resetFields()};Z(()=>{d(),U()});const A=async a=>{b.value="\u7F16\u8F91\u7528\u6237",f.value=!0,y.value="edit",await D(),w.value.resetFields(),Object.assign(c.value,a)},Q=async a=>{await ne("\u786E\u8BA4\u5220\u9664\uFF1F","\u63D0\u793A");let e={_id:a._id,action:"delete"};await q(e),await d({...g.value,...p.value}),V.success("\u5220\u9664\u6210\u529F")},G=async a=>{h.value=!0,K.value=a.roleName,I.value=a._id;let{checkedKeys:e}=a.permissionList;await D(),k.value.setCheckedKeys(e)},J=async()=>{let a=k.value.getCheckedNodes(),e=[],n=[],t=k.value.getHalfCheckedKeys();a.map(r=>{r.children?n.push(r._id):e.push(r._id)});let m={_id:I.value,permissionList:{checkedKeys:e,halfCheckedKeys:n.concat(t)}};await de(m),h.value=!1,await d(),V.success("\u66F4\u65B0\u6210\u529F")},W=[{label:"\u89D2\u8272\u540D\u79F0",prop:"roleName",width:"60"},{label:"\u5907\u6CE8",prop:"remark",width:"60"},{label:"\u6743\u9650\u5217\u8868",prop:"permissionList",width:"170",formatter(a,e,n){let t=n.halfCheckedKeys||[],m=[];return t.map(r=>{let N=T.value[r];r&&N&&m.push(T.value[r])}),m.join(",")}},{label:"\u521B\u5EFA\u65F6\u95F4",prop:"createTime",width:"80",formatter(a,e,n){return z(n).locale("zh-cn").format("YYYY/MM/DD A hh:mm ")}},{width:"100",fixed:"right",showOperation:!0,operationConfig:{type:"button",buttons:[{title:"\u7F16\u8F91",func:A,link:!0,type:"primary"},{title:"\u8BBE\u7F6E\u6743\u9650",func:G,link:!0,type:"primary"},{title:"\u5220\u9664",func:Q,link:!0,type:"danger"}]}}];return(a,e)=>{const n=_("el-input"),t=_("el-form-item"),m=_("el-form"),r=_("el-button"),N=_("el-dialog"),X=_("el-tree");return ee(),ae("div",ce,[C("div",pe,[l(m,{inline:!0,model:g.value,ref_key:"elFormRef",ref:S},{default:s(()=>[l(t,{label:"\u89D2\u8272\u540D\u79F0",prop:"roleName"},{default:s(()=>[l(n,{modelValue:g.value.roleName,"onUpdate:modelValue":e[0]||(e[0]=u=>g.value.roleName=u),placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D\u79F0"},null,8,["modelValue"])]),_:1}),l(t,null,{default:s(()=>[l(oe,{query:d,"re-set":Y})]),_:1})]),_:1},8,["model"])]),C("div",fe,[l(r,{type:"primary",onClick:$},{default:s(()=>[_e]),_:1})],512),C("div",ve,[l(se,{ref_key:"commonTableRef",ref:F,tableHeight:450,rowKey:"roleId",selectable:!1,tableData:L.value,columnData:W,currentPage:p.value.pageNum,pageSize:p.value.pageSize,total:P.value,onHandleSizeChange:j,onHandleCurrentChange:O},null,8,["tableData","currentPage","pageSize","total"])]),l(N,{title:b.value,width:"40%",modelValue:f.value,"onUpdate:modelValue":e[4]||(e[4]=u=>f.value=u)},{footer:s(()=>[l(r,{onClick:e[3]||(e[3]=u=>f.value=!1)},{default:s(()=>[he]),_:1}),l(r,{type:"primary",onClick:H},{default:s(()=>[ge]),_:1})]),default:s(()=>[l(m,{rules:E,model:c.value,"label-width":"80px","label-position":"right",ref_key:"roleInfoTable",ref:w},{default:s(()=>[l(t,{label:"\u89D2\u8272\u540D",prop:"roleName"},{default:s(()=>[l(n,{modelValue:c.value.roleName,"onUpdate:modelValue":e[1]||(e[1]=u=>c.value.roleName=u),placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D",disabled:b.value==="\u7F16\u8F91\u89D2\u8272"},null,8,["modelValue","disabled"])]),_:1}),l(t,{label:"\u5907\u6CE8",prop:"remark"},{default:s(()=>[l(n,{modelValue:c.value.remark,"onUpdate:modelValue":e[2]||(e[2]=u=>c.value.remark=u),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),l(N,{title:"\u8BBE\u7F6E\u6743\u9650",width:"40%",modelValue:h.value,"onUpdate:modelValue":e[6]||(e[6]=u=>h.value=u)},{footer:s(()=>[l(r,{onClick:e[5]||(e[5]=u=>h.value=!1)},{default:s(()=>[be]),_:1}),l(r,{type:"primary",onClick:J},{default:s(()=>[we]),_:1})]),default:s(()=>[l(m,{"label-width":"80px","label-position":"right"},{default:s(()=>[l(t,{label:"\u89D2\u8272\u540D"},{default:s(()=>[v(le(K.value),1)]),_:1}),l(t,{label:"\u6743\u9650"},{default:s(()=>[C("div",ye,[l(X,{ref_key:"permissionTree",ref:k,data:R.value,"show-checkbox":"","default-expand-all":"","node-key":"_id","highlight-current":"",props:{label:"menuName"}},null,8,["data"])])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},De=ue(ke,[["__scopeId","data-v-e4e8701b"]]);export{De as default};
