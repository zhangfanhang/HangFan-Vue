import{r as b}from"./request.d016c993.js";import{N as w,q as s,n as ae,r as i,S as te,o as y,b as R,g as k,e,w as o,L as oe,a as F,F as ue,d as re,i as g,E as N,Q as B}from"./index.97ded6be.js";import{_ as se,C as ne}from"./CommonBtns.c3b1a12c.js";import{r as de}from"./zh-cn.54e2677e.js";import{u as ie}from"./useMessageBox.6d5b6efb.js";import{_ as me}from"./_plugin-vue_export-helper.cdc0426e.js";async function pe(v){return b({url:"/users/list",method:"get",data:v})}async function ce(v){return b({url:"/users/delete",method:"post",data:v})}function ve(){return b({url:"/dept/list",method:"get"})}function fe(){return b({url:"/roles/allList",method:"get"})}async function _e(v){return b({url:"/users/operate",method:"post",data:v})}const be={class:"user-manage"},ge={class:"user-manage-from"},he={class:"user-manage-table-btns",ref:"testRef"},Ve=g("\u65B0\u589E"),we=g("\u6279\u91CF\u5220\u9664"),ye={class:"user-manage-table"},Ne=g("@imooc.com"),Ie=g("\u53D6 \u6D88"),Ce=g("\u786E \u5B9A"),Ue={__name:"User",setup(v){w.locale("zh-cn"),w.extend(de);let u=s({userName:"",userEmail:"",mobile:"",job:"",state:"",roleList:[],deptId:[]}),h=s(""),L=s([]),S=s([]);const M={userName:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",trigger:"change"}],userEmail:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u90AE\u7BB1",trigger:"change"}],mobile:[{pattern:/^(13[0-9]|14[01456879]|15[0-35-9]|16[2567]|17[0-8]|18[0-9]|19[0-35-9])\d{8}$/,message:"\u8BF7\u8F93\u5165\u6B63\u786E\u624B\u673A\u53F7",trigger:"change"}],deptId:[{required:!0,message:"\u8BF7\u9009\u62E9\u7528\u6237\u6240\u5C5E\u90E8\u95E8",trigger:"change"}]};let f=s(!1),_=s("\u65B0\u589E\u7528\u6237");const x=s(),I=s(),C=s(),d=s({userId:"",userName:"",state:""});let m=s({pageSize:10,pageNum:1}),U=s([]),z=s(!0),T=s(0),E=s([]);const P=async()=>{C.value.validate(async t=>{t&&(console.log(u.value),await _e({...u.value,action:h.value}),h.value==="add"?N.success("\u7528\u6237\u521B\u5EFA\u6210\u529F"):N.success("\u4FE1\u606F\u66F4\u65B0\u6210\u529F"),await p(),f.value=!1)})},A=()=>{x.value.resetFields(),I.value.clearAllChecked(),p()},p=async()=>{z.value=!0;let t={...d.value,...m.value},{list:l,page:r}=await pe(t);T.value=r.total,E.value=l,z.value=!1},H=t=>{m.value.pageSize=t.pageSize,m.value.pageNum=t.currentPage,p()},Y=t=>{m.value.pageNum=t,p()},O=async()=>{f.value=!0,_.value="\u65B0\u589E\u7528\u6237",h.value="add",await B(),C.value.resetFields()};ae(()=>{p(),$(),K()});const $=async()=>{L.value=await fe()},K=async()=>{S.value=await ve()},Q=async t=>{_.value="\u7F16\u8F91\u7528\u6237",f.value=!0,h.value="edit",await B(),Object.assign(u.value,t)},G=async t=>{await j([t.userId])},J=async()=>{U.value.length===0?N.error("\u8BF7\u9009\u62E9\u9700\u8981\u5220\u9664\u7684\u7528\u6237"):(await j(U.value.map(t=>t.userId)),I.value.clearAllChecked())},j=async t=>{await ie("\u786E\u8BA4\u5220\u9664\uFF1F","\u63D0\u793A"),await ce({userIds:t}),await p({...d.value,...m.value}),N.success("\u5220\u9664\u6210\u529F")},W=t=>{U.value=t},X=[{label:"\u7528\u6237\u89D2\u8272",prop:"role",width:"80",formatter(t,l,r){return{0:"\u7BA1\u7406\u5458",1:"\u666E\u901A\u7528\u6237"}[r]}},{label:"\u7528\u6237Id",prop:"userId",width:"60"},{label:"\u7528\u6237\u540D",prop:"userName",width:"60"},{label:"\u7528\u6237\u90AE\u7BB1",prop:"userEmail",width:"110",formatter(...t){return t[2]+"@imooc.com"}},{label:"\u7528\u6237\u804C\u4F4D",prop:"job",width:"80"},{label:"\u7528\u6237\u624B\u673A",prop:"mobile",width:"110"},{label:"\u7528\u6237\u72B6\u6001",prop:"state",width:"70",formatter(t,l,r){return{1:"\u5728\u804C",2:"\u79BB\u804C",3:"\u8BD5\u7528\u671F"}[r]}},{label:"\u6CE8\u518C\u65F6\u95F4",prop:"createTime",width:"130",formatter(t,l,r){return w(r).locale("zh-cn").format("YYYY/MM/DD A hh:mm ")}},{label:"\u6700\u540E\u767B\u5F55\u65F6\u95F4",prop:"lastLoginTime",width:"130",formatter(t,l,r){return r===null?"\u4ECE\u672A\u767B\u5F55":w(r).locale("zh-cn").fromNow()}},{width:"110",fixed:"right",showOperation:!0,operationConfig:{type:"button",buttons:[{title:"\u7F16\u8F91",func:Q,link:!0,type:"primary"},{title:"\u5220\u9664",func:G,link:!0,type:"danger"}]}}];return(t,l)=>{const r=i("el-input"),n=i("el-form-item"),c=i("el-option"),D=i("el-select"),q=i("el-form"),V=i("el-button"),Z=i("el-cascader"),ee=i("el-dialog"),le=te("permission");return y(),R("div",be,[k("div",ge,[e(q,{inline:!0,model:d.value,ref_key:"elFormRef",ref:x},{default:o(()=>[e(n,{label:"\u7528\u6237ID",prop:"userId"},{default:o(()=>[e(r,{modelValue:d.value.userId,"onUpdate:modelValue":l[0]||(l[0]=a=>d.value.userId=a),placeholder:"\u8BF7\u8F93\u5165\u7528\u6237ID"},null,8,["modelValue"])]),_:1}),e(n,{label:"\u7528\u6237\u540D",prop:"userName"},{default:o(()=>[e(r,{modelValue:d.value.userName,"onUpdate:modelValue":l[1]||(l[1]=a=>d.value.userName=a),placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D"},null,8,["modelValue"])]),_:1}),e(n,{label:"\u7528\u6237\u72B6\u6001",prop:"state"},{default:o(()=>[e(D,{modelValue:d.value.state,"onUpdate:modelValue":l[2]||(l[2]=a=>d.value.state=a),placeholder:"\u8BF7\u9009\u62E9\u7528\u6237\u72B6\u6001"},{default:o(()=>[e(c,{label:"\u5728\u804C",value:1}),e(c,{label:"\u79BB\u804C",value:2}),e(c,{label:"\u8BD5\u7528\u671F",value:3})]),_:1},8,["modelValue"])]),_:1}),e(n,null,{default:o(()=>[e(se,{query:p,"re-set":A})]),_:1})]),_:1},8,["model"])]),k("div",he,[oe((y(),F(V,{type:"primary",onClick:O},{default:o(()=>[Ve]),_:1})),[[le,"user-create"]]),e(V,{onClick:J},{default:o(()=>[we]),_:1})],512),k("div",ye,[e(ne,{ref_key:"commonTableRef",ref:I,tableHeight:450,rowKey:"userId",onHandleSelectionChange:W,tableData:E.value,columnData:X,currentPage:m.value.pageNum,pageSize:m.value.pageSize,total:T.value,onHandleSizeChange:H,onHandleCurrentChange:Y},null,8,["tableData","currentPage","pageSize","total"])]),e(ee,{title:_.value,width:"40%",modelValue:f.value,"onUpdate:modelValue":l[11]||(l[11]=a=>f.value=a)},{footer:o(()=>[e(V,{onClick:l[10]||(l[10]=a=>f.value=!1)},{default:o(()=>[Ie]),_:1}),e(V,{type:"primary",onClick:P},{default:o(()=>[Ce]),_:1})]),default:o(()=>[e(q,{rules:M,model:u.value,"label-width":"80px","label-position":"right",ref_key:"userInfoTable",ref:C},{default:o(()=>[e(n,{label:"\u7528\u6237\u540D",prop:"userName"},{default:o(()=>[e(r,{modelValue:u.value.userName,"onUpdate:modelValue":l[3]||(l[3]=a=>u.value.userName=a),placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",disabled:_.value==="\u7F16\u8F91\u7528\u6237"},null,8,["modelValue","disabled"])]),_:1}),e(n,{label:"\u90AE\u7BB1",prop:"userEmail"},{default:o(()=>[e(r,{modelValue:u.value.userEmail,"onUpdate:modelValue":l[4]||(l[4]=a=>u.value.userEmail=a),placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u90AE\u7BB1",disabled:_.value==="\u7F16\u8F91\u7528\u6237"},{append:o(()=>[Ne]),_:1},8,["modelValue","disabled"])]),_:1}),e(n,{label:"\u624B\u673A\u53F7",prop:"mobile"},{default:o(()=>[e(r,{modelValue:u.value.mobile,"onUpdate:modelValue":l[5]||(l[5]=a=>u.value.mobile=a),placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u624B\u673A\u53F7"},null,8,["modelValue"])]),_:1}),e(n,{label:"\u5C97\u4F4D",prop:"job"},{default:o(()=>[e(r,{modelValue:u.value.job,"onUpdate:modelValue":l[6]||(l[6]=a=>u.value.job=a),placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u5C97\u4F4D"},null,8,["modelValue"])]),_:1}),e(n,{label:"\u72B6\u6001",prop:"state"},{default:o(()=>[e(D,{modelValue:u.value.state,"onUpdate:modelValue":l[7]||(l[7]=a=>u.value.state=a),placeholder:"\u8BF7\u9009\u62E9\u7528\u6237\u72B6\u6001"},{default:o(()=>[e(c,{label:"\u5728\u804C",value:1}),e(c,{label:"\u79BB\u804C",value:2}),e(c,{label:"\u8BD5\u7528\u671F",value:3})]),_:1},8,["modelValue"])]),_:1}),e(n,{label:"\u7CFB\u7EDF\u89D2\u8272",prop:"roleList"},{default:o(()=>[e(D,{modelValue:u.value.roleList,"onUpdate:modelValue":l[8]||(l[8]=a=>u.value.roleList=a),placeholder:"\u8BF7\u9009\u62E9\u7528\u6237\u7CFB\u7EDF\u89D2\u8272",multiple:"",style:{width:"100%"}},{default:o(()=>[(y(!0),R(ue,null,re(L.value,a=>(y(),F(c,{label:a.roleName,value:a._id,key:a._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(n,{label:"\u90E8\u95E8",prop:"deptId"},{default:o(()=>[e(Z,{placeholder:"\u8BF7\u9009\u62E9\u7528\u6237\u6240\u5C5E\u90E8\u95E8",modelValue:u.value.deptId,"onUpdate:modelValue":l[9]||(l[9]=a=>u.value.deptId=a),options:S.value,props:{checkStrictly:!0,value:"_id",label:"deptName"},clearable:""},null,8,["modelValue","options"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}},Te=me(Ue,[["__scopeId","data-v-8dd85ce8"]]);export{Te as default};
