import{N as b,q as n,n as H,r,o as V,b as C,g,e as o,w as s,F as K,d as P,a as Q,i as h,E as I,Q as D,z as G,A as J}from"./index.97ded6be.js";import{r as W}from"./zh-cn.54e2677e.js";import{_ as X,C as Z}from"./CommonBtns.c3b1a12c.js";import{u as ee}from"./useMessageBox.6d5b6efb.js";import{r as w}from"./request.d016c993.js";import{_ as ae}from"./_plugin-vue_export-helper.cdc0426e.js";function te(u){return w({url:"/dept/list",method:"get",data:u})}async function U(u){return w({url:"/dept/operate",method:"post",data:u})}function le(u){return w({url:"/users/all/list",method:"get",data:u})}const oe=u=>(G("data-v-fe8225a2"),u=u(),J(),u),se={class:"dept-manage"},ne={class:"dept-manage-from"},ue={class:"dept-manage-table-btns",ref:"testRef"},re=h("\u65B0\u589E"),de={class:"dept-manage-table"},ie=oe(()=>g("span",{style:{"margin-left":"10px"}},"\u82E5\u4E3A\u7A7A,\u9ED8\u8BA4\u4E3A\u4E00\u7EA7\u90E8\u95E8",-1)),pe=h("@imooc.com"),me=h("\u53D6 \u6D88"),ce=h("\u786E \u5B9A"),_e={__name:"Dept",setup(u){b.locale("zh-cn"),b.extend(W);const t=n({parentId:[null],deptName:"",user:"",userEmail:""}),$={deptName:{required:!0,message:"\u8BF7\u8F93\u5165\u90E8\u95E8\u540D\u79F0",trigger:"change"},user:{required:!0,message:"\u8BF7\u9009\u62E9\u8D1F\u8D23\u4EBA",trigger:"change"}};let m=n(""),d=n(!1),c=n("\u65B0\u589E\u90E8\u95E8");const k=n(),F=n(),_=n(),v=n({deptName:""});let E=n(!0),y=n([]),x=n([]);const Y=async()=>{let e=t.value.user.split(",");_.value.validate(async a=>{a&&(await U({_id:t.value._id,parentId:t.value.parentId,deptName:t.value.deptName,userId:e[0],userName:e[2],userEmail:e[1],action:m.value}),m.value==="create"?I.success("\u90E8\u95E8\u521B\u5EFA\u6210\u529F"):I.success("\u4FE1\u606F\u66F4\u65B0\u6210\u529F"),await f(),d.value=!1)})},A=()=>{k.value.resetFields(),f()},M=async()=>{x.value=await le()},f=async()=>{E.value=!0;let e={...v.value};y.value=await te(e),E.value=!1},q=async()=>{d.value=!0,c.value="\u65B0\u589E\u90E8\u95E8",m.value="create",await D(),_.value.resetFields()},L=e=>{e===""?t.value.userEmail="":t.value.userEmail=e.split(",")[1]};H(()=>{f(),M()});const B=e=>{e===null&&(t.value.parentId=[null])},R=[{label:"\u90E8\u95E8\u540D\u79F0",prop:"deptName",width:"60"},{label:"\u8D1F\u8D23\u4EBA",prop:"userName",width:"60"},{label:"\u4FEE\u6539\u65F6\u95F4",prop:"updateTime",width:"80",formatter(e,a,i){return b(i).locale("zh-cn").format("YYYY/MM/DD A hh:mm ")}},{label:"\u521B\u5EFA\u65F6\u95F4",prop:"createTime",width:"80",formatter(e,a,i){return b(i).locale("zh-cn").format("YYYY/MM/DD A hh:mm ")}},{width:"100",fixed:"right",showOperation:!0,operationConfig:{type:"button",buttons:[{title:"\u7F16\u8F91",func:async e=>{c.value="\u7F16\u8F91\u90E8\u95E8",d.value=!0,m.value="edit",await D(),_.value.resetFields(),Object.assign(t.value,e,{user:`${e.userId},${e.userEmail},${e.userName}`})},link:!0,type:"primary"},{title:"\u65B0\u589E",func:async e=>{c.value="\u65B0\u589E\u90E8\u95E8",d.value=!0,m.value="create",await D(),_.value.resetFields(),e.parentId[0]!==null?t.value.parentId=[...e.parentId,e._id]:t.value.parentId=[e._id]},link:!0,type:"primary"},{title:"\u5220\u9664",func:async e=>{await ee("\u786E\u8BA4\u5220\u9664\uFF1F","\u63D0\u793A");let a={_id:e._id,action:"delete"};await U(a),await f({...v.value}),I.success("\u5220\u9664\u6210\u529F")},link:!0,type:"danger"}]}}];return(e,a)=>{const i=r("el-input"),p=r("el-form-item"),T=r("el-form"),N=r("el-button"),S=r("el-cascader"),z=r("el-option"),O=r("el-select"),j=r("el-dialog");return V(),C("div",se,[g("div",ne,[o(T,{inline:!0,model:v.value,ref_key:"elFormRef",ref:k},{default:s(()=>[o(p,{label:"\u90E8\u95E8\u540D\u79F0",prop:"deptName"},{default:s(()=>[o(i,{modelValue:v.value.deptName,"onUpdate:modelValue":a[0]||(a[0]=l=>v.value.deptName=l),placeholder:"\u8BF7\u8F93\u5165\u90E8\u95E8\u540D\u79F0"},null,8,["modelValue"])]),_:1}),o(p,null,{default:s(()=>[o(X,{query:f,"re-set":A})]),_:1})]),_:1},8,["model"])]),g("div",ue,[o(N,{type:"primary",onClick:q},{default:s(()=>[re]),_:1})],512),g("div",de,[o(Z,{ref_key:"commonTableRef",ref:F,tableHeight:510,rowKey:"_id",pagination:!1,selectable:!1,tableData:y.value,columnData:R},null,8,["tableData"])]),o(j,{title:c.value,width:"40%",modelValue:d.value,"onUpdate:modelValue":a[7]||(a[7]=l=>d.value=l)},{footer:s(()=>[o(N,{onClick:a[6]||(a[6]=l=>d.value=!1)},{default:s(()=>[me]),_:1}),o(N,{type:"primary",onClick:Y},{default:s(()=>[ce]),_:1})]),default:s(()=>[o(T,{rules:$,model:t.value,"label-width":"90px","label-position":"right",ref_key:"deptInfoTable",ref:_},{default:s(()=>[o(p,{label:"\u4E0A\u7EA7\u90E8\u95E8",prop:"parentId"},{default:s(()=>[o(S,{onChange:B,placeholder:"\u8BF7\u9009\u62E9\u4E0A\u7EA7\u90E8\u95E8",modelValue:t.value.parentId,"onUpdate:modelValue":a[1]||(a[1]=l=>t.value.parentId=l),options:y.value,props:{checkStrictly:!0,value:"_id",label:"deptName"},clearable:""},null,8,["modelValue","options"]),ie]),_:1}),o(p,{label:"\u90E8\u95E8\u540D\u79F0",prop:"deptName"},{default:s(()=>[o(i,{modelValue:t.value.deptName,"onUpdate:modelValue":a[2]||(a[2]=l=>t.value.deptName=l),placeholder:"\u8BF7\u8F93\u5165\u90E8\u95E8\u540D\u79F0",disabled:c.value==="\u7F16\u8F91\u89D2\u8272",clearable:""},null,8,["modelValue","disabled"])]),_:1}),o(p,{label:"\u8D1F\u8D23\u4EBA",prop:"user"},{default:s(()=>[o(O,{modelValue:t.value.user,"onUpdate:modelValue":a[3]||(a[3]=l=>t.value.user=l),onChange:a[4]||(a[4]=l=>L(t.value.user)),clearable:""},{default:s(()=>[(V(!0),C(K,null,P(x.value,l=>(V(),Q(z,{key:l._id,value:`${l.userId},${l.userEmail},${l.userName}`,label:l.userName},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(p,{label:"\u8D1F\u8D23\u4EBA\u90AE\u7BB1",prop:"userEmail"},{default:s(()=>[o(i,{modelValue:t.value.userEmail,"onUpdate:modelValue":a[5]||(a[5]=l=>t.value.userEmail=l),disabled:"",clearable:""},{append:s(()=>[pe]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}},De=ae(_e,[["__scopeId","data-v-fe8225a2"]]);export{De as default};
